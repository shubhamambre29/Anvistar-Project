<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%><%@ page session="true" %><%@ page import="java.util.List" %><%    if (session.getAttribute("userId") == null) {        response.sendRedirect("../index.jsp");        return;    }    String activeTab = (String) request.getAttribute("activeTab");    if (activeTab == null) activeTab = "client";%><!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Payments - DXSure CRM</title>    <link rel="stylesheet" href="../css/style.css"></head><body>    <div class="navbar">        <div class="brand"><img src="../images/logo.svg" alt="DXSure CRM"></div>        <a href="/admin/dashboard.jsp">Dashboard</a>        <a href="../client">Clients</a>        <a href="../vendor">Vendors</a>        <a href="../payment" style="color: var(--secondary-color);">Payments</a>        <a href="../ticket">Tickets</a>        <a href="../pettycash">Petty Cash</a>        <div class="user-menu">            <span>Welcome, <%= session.getAttribute("username") %></span>            <a href="../logout">Logout</a>        </div>    </div>    <div class="page-header">        <h1>Payment Management</h1>        <p class="subtitle">Track and manage client, vendor, and employee payments</p>    </div>    <div class="container">        <%            String success = (String) request.getAttribute("success");            String error   = (String) request.getAttribute("error");        %>        <% if (success != null) { %>        <div class="toast-notification toast-success" id="saveToast">            <div class="toast-icon-wrap">&#10004;</div>            <div class="toast-content"><div class="toast-title">Saved Successfully!</div><div class="toast-msg"><%= success %></div></div>            <button class="toast-dismiss" onclick="dismissToast('saveToast')">&#10005;</button>            <div class="toast-progress" style="animation-duration:4s"></div>        </div>        <% } %>        <% if (error != null) { %>        <div class="toast-notification toast-error" id="errToast">            <div class="toast-icon-wrap">&#10008;</div>            <div class="toast-content"><div class="toast-title">Error Occurred</div><div class="toast-msg"><%= error %></div></div>            <button class="toast-dismiss" onclick="dismissToast('errToast')">&#10005;</button>            <div class="toast-progress" style="animation-duration:6s"></div>        </div>        <% } %>        <script>        function dismissToast(id){var e=document.getElementById(id);if(e){e.classList.add('toast-hide');setTimeout(function(){e.remove();},380);}}        <% if (success != null) { %>setTimeout(function(){dismissToast('saveToast');},4000);<% } %>        <% if (error   != null) { %>setTimeout(function(){dismissToast('errToast');},6000);<% } %>        </script>        <!-- Tabs -->        <div style="display:flex; gap:4px; border-bottom:2px solid var(--primary-color); margin-bottom:2rem;">            <button id="tab-btn-client"   onclick="showTab('client')"   style="padding:0.6rem 1.4rem;border:none;cursor:pointer;font-size:1rem;border-radius:6px 6px 0 0;font-weight:600;">Client Payments</button>            <button id="tab-btn-vendor"   onclick="showTab('vendor')"   style="padding:0.6rem 1.4rem;border:none;cursor:pointer;font-size:1rem;border-radius:6px 6px 0 0;font-weight:600;">Vendor Payments</button>            <button id="tab-btn-employee" onclick="showTab('employee')" style="padding:0.6rem 1.4rem;border:none;cursor:pointer;font-size:1rem;border-radius:6px 6px 0 0;font-weight:600;">Employee Payments</button>        </div>        <!-- ===== CLIENT PAYMENTS ===== -->        <div id="section-client" style="display:none;">            <div style="margin-bottom:1.5rem;text-align:right;">                <button class="btn btn-success" onclick="toggleForm('frmClient')">+ Add Client Payment</button>            </div>            <div id="frmClient" style="display:none;background:white;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-bottom:2rem;">                <h3 style="color:var(--primary-color);margin-bottom:1.5rem;">Record Client Payment</h3>                <form method="POST" action="../payment">                    <input type="hidden" name="action" value="add">                    <input type="hidden" name="type"   value="client">                    <div class="form-row">                        <div class="form-group"><label>Client ID</label><input type="number" name="clientId" required placeholder="Client ID"></div>                        <div class="form-group"><label>Amount (&#8377;)</label><input type="number" name="amount" required step="0.01" placeholder="0.00"></div>                    </div>                    <div class="form-row">                        <div class="form-group"><label>Payment Method</label>                            <select name="paymentMethod"><option>Cash</option><option>Cheque</option><option>Bank Transfer</option><option>Card</option></select>                        </div>                    </div>                    <div class="form-group"><label>Description</label><textarea name="description" placeholder="Payment description"></textarea></div>                    <button type="submit" class="btn btn-success">Record Payment</button>                    <button type="button" class="btn btn-danger" onclick="toggleForm('frmClient')">Cancel</button>                </form>            </div>            <div class="table-container">                <h3 style="color:var(--primary-color);margin-bottom:1.5rem;">Client Payments</h3>                <table><thead><tr><th>ID</th><th>Client</th><th>Amount</th><th>Date</th><th>Method</th><th>Status</th></tr></thead>                <tbody>                <%                    List<String[]> clientPayments = (List<String[]>) request.getAttribute("clientPayments");                    if (clientPayments == null || clientPayments.isEmpty()) {                %><tr><td colspan="6" style="text-align:center;color:#888;">No client payments yet</td></tr><%                    } else { for (String[] p : clientPayments) {                %><tr>                    <td><%= p[0] %></td><td><strong><%= p[1] %></strong></td>                    <td>&#8377;<%= p[2] %></td>                    <td><%= p[3]!=null?p[3].substring(0,Math.min(10,p[3].length())):"-" %></td>                    <td><%= p[4]!=null?p[4]:"-" %></td>                    <td><span class="status-badge status-<%= p[5] %>"><%= p[5]!=null?p[5].toUpperCase():"" %></span></td>                </tr><% } } %>                </tbody></table>            </div>        </div>        <!-- ===== VENDOR PAYMENTS ===== -->        <div id="section-vendor" style="display:none;">            <div style="margin-bottom:1.5rem;text-align:right;">                <button class="btn btn-success" onclick="toggleForm('frmVendor')">+ Add Vendor Payment</button>            </div>            <div id="frmVendor" style="display:none;background:white;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-bottom:2rem;">                <h3 style="color:var(--primary-color);margin-bottom:1.5rem;">Record Vendor Payment</h3>                <form method="POST" action="../payment">                    <input type="hidden" name="action" value="add">                    <input type="hidden" name="type"   value="vendor">                    <div class="form-row">                        <div class="form-group"><label>Vendor ID</label><input type="number" name="vendorId" required placeholder="Vendor ID"></div>                        <div class="form-group"><label>Amount (&#8377;)</label><input type="number" name="amount" required step="0.01" placeholder="0.00"></div>                    </div>                    <div class="form-row">                        <div class="form-group"><label>Payment Method</label>                            <select name="paymentMethod"><option>Cash</option><option>Cheque</option><option>Bank Transfer</option><option>Card</option></select>                        </div>                        <div class="form-group"><label>Invoice Number</label><input type="text" name="invoiceNumber" placeholder="Invoice / ref. number"></div>                    </div>                    <div class="form-group"><label>Description</label><textarea name="description" placeholder="Payment description"></textarea></div>                    <button type="submit" class="btn btn-success">Record Payment</button>                    <button type="button" class="btn btn-danger" onclick="toggleForm('frmVendor')">Cancel</button>                </form>            </div>            <div class="table-container">                <h3 style="color:var(--primary-color);margin-bottom:1.5rem;">Vendor Payments</h3>                <table><thead><tr><th>ID</th><th>Vendor</th><th>Amount</th><th>Date</th><th>Invoice No.</th><th>Status</th></tr></thead>                <tbody>                <%                    List<String[]> vendorPayments = (List<String[]>) request.getAttribute("vendorPayments");                    if (vendorPayments == null || vendorPayments.isEmpty()) {                %><tr><td colspan="6" style="text-align:center;color:#888;">No vendor payments yet</td></tr><%                    } else { for (String[] p : vendorPayments) {                %><tr>                    <td><%= p[0] %></td><td><strong><%= p[1] %></strong></td>                    <td>&#8377;<%= p[2] %></td>                    <td><%= p[3]!=null?p[3].substring(0,Math.min(10,p[3].length())):"-" %></td>                    <td><%= p[4]!=null?p[4]:"-" %></td>                    <td><span class="status-badge status-<%= p[5] %>"><%= p[5]!=null?p[5].toUpperCase():"" %></span></td>                </tr><% } } %>                </tbody></table>            </div>        </div>        <!-- ===== EMPLOYEE PAYMENTS ===== -->        <div id="section-employee" style="display:none;">            <div style="margin-bottom:1.5rem;text-align:right;">                <button class="btn btn-success" onclick="toggleForm('frmEmployee')">+ Add Employee Payment</button>            </div>            <div id="frmEmployee" style="display:none;background:white;padding:2rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.1);margin-bottom:2rem;">                <h3 style="color:var(--primary-color);margin-bottom:1.5rem;">Record Employee Payment</h3>                <form method="POST" action="../payment">                    <input type="hidden" name="action" value="add">                    <input type="hidden" name="type"   value="employee">                    <div class="form-row">                        <div class="form-group"><label>Employee (User) ID</label><input type="number" name="employeeId" required placeholder="User ID"></div>                        <div class="form-group"><label>Amount (&#8377;)</label><input type="number" name="amount" required step="0.01" placeholder="0.00"></div>                    </div>                    <div class="form-row">                        <div class="form-group"><label>Payment Type</label>                            <select name="paymentType"><option>Salary</option><option>Bonus</option><option>Advance</option><option>Reimbursement</option><option>Other</option></select>                        </div>                    </div>                    <div class="form-group"><label>Description</label><textarea name="description" placeholder="Payment description"></textarea></div>                    <button type="submit" class="btn btn-success">Record Payment</button>                    <button type="button" class="btn btn-danger" onclick="toggleForm('frmEmployee')">Cancel</button>                </form>            </div>            <div class="table-container">                <h3 style="color:var(--primary-color);margin-bottom:1.5rem;">Employee Payments</h3>                <table><thead><tr><th>ID</th><th>Employee</th><th>Amount</th><th>Date</th><th>Type</th><th>Status</th></tr></thead>                <tbody>                <%                    List<String[]> employeePayments = (List<String[]>) request.getAttribute("employeePayments");                    if (employeePayments == null || employeePayments.isEmpty()) {                %><tr><td colspan="6" style="text-align:center;color:#888;">No employee payments yet</td></tr><%                    } else { for (String[] p : employeePayments) {                %><tr>                    <td><%= p[0] %></td><td><strong><%= p[1] %></strong></td>                    <td>&#8377;<%= p[2] %></td>                    <td><%= p[3]!=null?p[3].substring(0,Math.min(10,p[3].length())):"-" %></td>                    <td><%= p[4]!=null?p[4]:"-" %></td>                    <td><span class="status-badge status-<%= p[5] %>"><%= p[5]!=null?p[5].toUpperCase():"" %></span></td>                </tr><% } } %>                </tbody></table>            </div>        </div>    </div>    <footer><p>&copy; 2026 DXSure CRM. All rights reserved.</p></footer>    <script>    var activeTab = '<%= activeTab %>';    function showTab(name) {        ['client','vendor','employee'].forEach(function(t) {            document.getElementById('section-'+t).style.display = (t===name)?'block':'none';            var b = document.getElementById('tab-btn-'+t);            b.style.background = (t===name)?'var(--primary-color)':'#f0f4ff';            b.style.color      = (t===name)?'#fff':'#333';        });    }    function toggleForm(id) {        var f=document.getElementById(id);        f.style.display=(f.style.display==='none')?'block':'none';    }    showTab(activeTab);    </script></body></html>